generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String        @id @default(uuid())
  email        String        @unique
  passwordHash String
  name         String
  role         String        @default("STAFF")
  createdAt    DateTime      @default(now())
  transactions Transaction[]
}

model Warehouse {
  id                 String        @id @default(uuid())
  name               String
  location           String?
  type               String        @default("MAIN")
  stock              Stock[]
  sourceTransactions Transaction[] @relation("SourceWarehouse")
  targetTransactions Transaction[] @relation("TargetWarehouse")
}

model Product {
  id               String            @id @default(uuid())
  sku              String            @unique
  name             String
  description      String?
  category         String?
  uom              String            @default("UNIT")
  minStock         Int               @default(10)
  stock            Stock[]
  transactionItems TransactionItem[]
}

model Stock {
  id          String    @id @default(uuid())
  warehouseId String
  productId   String
  quantity    Int       @default(0)
  product     Product   @relation(fields: [productId], references: [id])
  warehouse   Warehouse @relation(fields: [warehouseId], references: [id])

  @@unique([warehouseId, productId])
}

model Transaction {
  id                String            @id @default(uuid())
  type              String
  status            String            @default("DRAFT")
  reference         String?
  notes             String?
  date              DateTime          @default(now())
  createdById       String
  sourceWarehouseId String?
  targetWarehouseId String?
  adjustmentType    String?
  ledgerEntries     Ledger[]
  createdBy         User              @relation(fields: [createdById], references: [id])
  sourceWarehouse   Warehouse?        @relation("SourceWarehouse", fields: [sourceWarehouseId], references: [id])
  targetWarehouse   Warehouse?        @relation("TargetWarehouse", fields: [targetWarehouseId], references: [id])
  items             TransactionItem[]
}

model TransactionItem {
  id            String      @id @default(uuid())
  transactionId String
  productId     String
  quantity      Int
  product       Product     @relation(fields: [productId], references: [id])
  transaction   Transaction @relation(fields: [transactionId], references: [id])
}

model Ledger {
  id             String      @id @default(uuid())
  transactionId  String
  productId      String
  warehouseId    String
  quantityChange Int
  balanceAfter   Int
  createdAt      DateTime    @default(now())
  transaction    Transaction @relation(fields: [transactionId], references: [id])
}
